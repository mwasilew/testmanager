{% extends 'testrunner/base.html' %}

{% block maincontent %}
  
  {% if jenkins_build %}
    <div class="row">
      <form action="/testrunner/compare_results/" method="GET">
	<div class="col-lg-12">
          {% for build in jenkins_build %}
            <div class="page-header">
	      <h2>{{ build.name }}</h2>
	      <h3><a href="{{ build.job.get_absolute_url }}">{{ build.job.name }}</a></h3>
            </div>
            {% for subbuild in build.jenkinsbuild_set.all %}
	      <div class="row">
		<div class="page-header">
		  <h3>{{ subbuild.get_hwpack_name }}</h3>
		</div>
		<table id="job-status" class="table table-striped table-condensed">
		  <thead>
                    <tr>
                      <th>Build name</th>
                      <th>Build status</th>
                      <th>Build number</th>
                      <th>Date</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="job-status-body">
                    <tr>
                      <td>{{ subbuild.name }}</td>
                      <td>{{ subbuild.status.name }}</td>
                      <td>{{ subbuild.number }}</td>
                      <td>{{ subbuild.timestamp }}</td>
                      <td><a href="{{ jjob.get_last_build.get_absolute_url }}"><i class="fa fa-search"></i></a></td>
                    </tr>
                  </tbody>
		</table>
		<div class="col-lg-1 col-lg-offset-11">
		  <button type="submit" class="btn btn-default">Compare</button>
		</div>

                {% for lavajob in subbuild.lavajob_set.all %}
                  <div class="col-lg-9 col-lg-offset-3">
                    <div class="page-header">
                      <h4>
			{{ lavajob.device_type.name }} 
			<a href="{{ lavajob.get_absolute_url }}">#{{ lavajob.number }}</a>
		      </h4>
                    </div>
                    <table id="job-status" class="table table-striped table-condensed">
                      <thead>
                        <tr>
                          <th>Test name</th>
                          <th>Test status</th>
                          <th>Pass</th>
                          <th>Fail</th>
                          <th>Compare</th>
                        </tr>
                      </thead>
                      <tbody id="job-status-body">
                        {% for testdef, testresult in lavajob.get_definitions_results %}
                          <tr>
                            <td>{{ testdef.name }}</td>
                            <td>{% if testresult %} OK {% else %} Missing {% endif %}</td>
                            <td>{{ testresult.get_resultset_count_by_status.pass }}</td>
                            <td>{{ testresult.get_resultset_count_by_status.fail }}</td>
                            <td>
			      {% if testresult %}
				<input type="checkbox" value="{{ testresult.pk }}" name="testresults"/>
			      {% endif %}
			    </td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                {% endfor %}
	      </div>
            {% endfor %}
          {% endfor %}
	</div>
      </form>
    </div>
  {% endif %}
  
{% endblock %}
